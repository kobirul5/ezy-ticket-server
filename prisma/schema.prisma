generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         Int        @id @default(autoincrement())
  name       String
  email      String     @unique
  password   String?
  role       Role       @default(USER)
  phone      String?
  address    String?
  picture    String?
  status     UserStatus @default(ACTIVE)
  isVerified Boolean    @default(false)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  events      Event[]
  reviews     EventReview[]
  orders      Order[]
  wishlists   Wishlist[]
  busServices BusService[]
}

model Event {
  id           Int      @id @default(autoincrement())
  title        String
  eventType    String
  eventDate    String
  eventTime    String
  duration     String
  price        Float
  totalTickets Int
  location     String
  details      String
  managerEmail String
  status       String   @default("pending") // pending, verified, rejected
  advertise    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  manager User @relation(fields: [managerEmail], references: [email])

  reviews   EventReview[]
  wishlists Wishlist[]
}

model EventReview {
  id            Int      @id @default(autoincrement())
  eventId       Int
  eventName     String
  comment       String
  customerEmail String
  customerName  String
  customerPhoto String?
  time          String
  category      String
  status        String   @default("pending")
  createdAt     DateTime @default(now())

  event    Event @relation(fields: [eventId], references: [id])
  customer User  @relation(fields: [customerEmail], references: [email])
}

model CinemaHall {
  id         Int      @id @default(autoincrement())
  name       String
  location   String
  totalSeats Int
  price      Float
  facilities String[]
  email      String
  image      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  movies Movie[] @relation("CinemaHallToMovie")
}

model Movie {
  id          Int      @id @default(autoincrement())
  name        String
  description String
  duration    String
  category    String
  genre       String
  actors      String[]
  releaseDate String
  language    String
  director    String
  imageLink   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  cinemaHalls CinemaHall[] @relation("CinemaHallToMovie")
}

model BusService {
  id                  Int        @id @default(autoincrement())
  name                String
  email               String
  busType             BusType    @default(NON_AC)
  contact             String
  travelTime          String[]
  travelOffDates      DateTime[]
  image               String?
  totalSeats          Int        @default(52)
  price               Float      @default(350)
  departureLocation   String[]
  destinationLocation String[]
  userId              Int
  user                User       @relation(fields: [userId], references: [id])

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  busSchedules BusSchedule[]
}

model BusSchedule {
  id           Int        @id @default(autoincrement())
  bookedSeats  String[]
  time         String
  busServiceId Int
  busService   BusService @relation(fields: [busServiceId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

enum BusType {
  AC
  NON_AC
}

model Order {
  id            Int           @id @default(autoincrement())
  userId        Int?
  customerName  String
  customerEmail String
  productId     Int
  productType   ProductType   @default(BUS)
  totalAmount   Float
  currency      Currency      @default(BDT)
  tranId        String        @unique
  paidStatus    Boolean       @default(false)
  paymentMethod PaymentMethod @default(SSLCOMMERZ)
  status        OrderStatus   @default(PENDING)
  orderData     Json?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  user          User?         @relation(fields: [customerEmail], references: [email])
}

enum PaymentMethod {
  SSLCOMMERZ
  STRIPE
}

enum Currency {
  BDT
  USD
}

enum ProductType {
  EVENT
  BUS
}

enum OrderStatus {
  PENDING
  SUCCESSED
  CANCELLED
  FAILED
}

model Wishlist {
  id        Int      @id @default(autoincrement())
  userEmail String
  eventId   Int
  createdAt DateTime @default(now())

  user  User  @relation(fields: [userEmail], references: [email])
  event Event @relation(fields: [eventId], references: [id])

  @@unique([userEmail, eventId])
}

enum Role {
  SUPER_ADMIN
  ADMIN
  EVENT_MANAGER
  TRAVEL_MANAGER
  ENTERTAINMENT_MANAGER
  USER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  BLOCKED
  SUSPENDED
}

model TravelLocation {
  id        Int      @id @default(autoincrement())
  name      String
  address   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
